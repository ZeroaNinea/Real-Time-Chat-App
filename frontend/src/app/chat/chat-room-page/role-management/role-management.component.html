<div class="role-management-container">
  <div class="create-role">
    <h2>Manage Roles</h2>

    <form>
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Role Name</mat-label>
        <input
          matInput
          placeholder="e.g., Moderator"
          [(ngModel)]="role.name"
          name="name"
          required
        />
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Description</mat-label>
        <textarea
          matInput
          placeholder="Optional description"
          [(ngModel)]="role.description"
          name="description"
          rows="3"
        ></textarea>
      </mat-form-field>

      <h3>Permissions</h3>
      <mat-selection-list [(ngModel)]="role.permissions" name="permissions">
        @for (permission of allPermissions; track $index) {
        <mat-list-option [value]="permission">
          {{ permission }}
        </mat-list-option>
        }
      </mat-selection-list>

      <h3>Allowed User IDs</h3>
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Select Users</mat-label>
        <input
          matInput
          [(ngModel)]="role.allowedUserIds"
          name="allowedUserIds"
          placeholder="Enter User IDs (comma-separated)"
        />
      </mat-form-field>

      <h3>Allowed Roles</h3>
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Which roles can assign this?</mat-label>
        <mat-select
          multiple
          [(ngModel)]="role.allowedRoles"
          name="allowedRoles"
        >
          @for (existingRole of roles; track $index) {
          <mat-option [value]="existingRole.name">
            {{ existingRole.name }}
          </mat-option>
          }
        </mat-select>
      </mat-form-field>

      <mat-slide-toggle
        [(ngModel)]="role.canBeSelfAssigned"
        name="canBeSelfAssigned"
      >
        Can be self-assigned
      </mat-slide-toggle>

      <div class="actions">
        <button mat-raised-button class="primary" type="submit">
          Save Role
        </button>
        <button
          mat-stroked-button
          type="button"
          (click)="cancel()"
          class="warn"
        >
          Cancel
        </button>
      </div>
    </form>
  </div>
  <div class="choose-role">
    <h2>Choose Your Roles</h2>
    <mat-selection-list [(ngModel)]="role.name" name="permissions">
      @for (role of roles; track $index) {
      <div matRipple [matRippleTrigger]="trigger">
        <div #trigger class="role-item-container">
          <mat-list-option [value]="role.name" disableRipple="true">
            <div class="role-item">
              <span class="role-name">{{ role.name }}</span>
              <button
                mat-icon-button
                matTooltip="Rename"
                (click)="editRole(role)"
                aria-label="Edit role"
              >
                <mat-icon>edit</mat-icon>
              </button>
              <button
                mat-icon-button
                type="button"
                tabindex="-1"
                (click)="deleteRole(role); $event.stopPropagation()"
              >
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </mat-list-option>
          <div class="role-description">
            <span>{{ role.description }}</span>
            <strong>Permissions:</strong>
            <span class="permissions">{{ role.permissions.join(", ") }}</span>
          </div>
        </div>
      </div>
      }
    </mat-selection-list>
  </div>
</div>
